<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫•u Tr√∫c Database - IoT Smart Door System</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        h2 {
            color: #667eea;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 2em;
        }

        h3 {
            color: #764ba2;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .mermaid {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }

        tbody tr:hover {
            background: #f5f5f5;
            transition: background 0.3s ease;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #d63384;
            font-size: 0.9em;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        pre code {
            background: transparent;
            color: #f8f8f2;
            padding: 0;
        }

        .section {
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .summary {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .summary ul {
            list-style: none;
            padding-left: 0;
        }

        .summary li {
            padding: 10px 0;
            font-size: 1.1em;
        }

        .summary li::before {
            margin-right: 10px;
        }

        hr {
            border: none;
            border-top: 2px solid #e0e0e0;
            margin: 40px 0;
        }

        ul,
        ol {
            margin-left: 30px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 8px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 8px;
        }

        .badge-primary {
            background: #667eea;
            color: white;
        }

        .badge-success {
            background: #4CAF50;
            color: white;
        }

        .badge-warning {
            background: #FF9800;
            color: white;
        }

        .badge-info {
            background: #2196F3;
            color: white;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üîê C·∫•u Tr√∫c Database</h1>
            <p>IoT Smart Door System</p>
        </div>

        <div class="content">
            <h2>üìã T·ªïng Quan</h2>
            <p>Database c·ªßa h·ªá th·ªëng IoT Smart Door ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ qu·∫£n l√Ω ng∆∞·ªùi d√πng, l·ªãch s·ª≠ ho·∫°t ƒë·ªông, th·∫ª RFID v√†
                log h·ªá th·ªëng. H·ªá th·ªëng s·ª≠ d·ª•ng MySQL/MariaDB v·ªõi engine InnoDB v√† charset UTF-8.</p>

            <h2>üó∫Ô∏è S∆° ƒê·ªì ERD (Entity Relationship Diagram)</h2>
            <div class="mermaid">
                erDiagram
                users ||--o{ activity_history : "creates"
                users ||--o{ rfid_cards : "owns"

                users {
                INT id PK "AUTO_INCREMENT"
                VARCHAR(50) username UK "UNIQUE, NOT NULL"
                VARCHAR(255) password_hash "NOT NULL"
                VARCHAR(100) full_name
                ENUM role "admin, user"
                TIMESTAMP created_at
                TIMESTAMP updated_at
                TIMESTAMP last_login "NULL"
                BOOLEAN is_active "DEFAULT TRUE"
                }

                activity_history {
                INT id PK "AUTO_INCREMENT"
                ENUM type "system, unlock, lock, rfid, ping, buzz, door, motion, bell"
                VARCHAR(255) title "NOT NULL"
                TEXT description
                VARCHAR(500) icon
                INT user_id FK "NULL"
                TIMESTAMP created_at
                JSON metadata
                BOOLEAN is_deleted "DEFAULT FALSE"
                }

                rfid_cards {
                INT id PK "AUTO_INCREMENT"
                VARCHAR(50) uid UK "UNIQUE, NOT NULL"
                VARCHAR(100) owner_name
                TEXT description
                ENUM status "active, inactive, blocked"
                TIMESTAMP created_at
                TIMESTAMP updated_at
                TIMESTAMP last_used "NULL"
                INT user_id FK "NULL"
                }

                system_logs {
                INT id PK "AUTO_INCREMENT"
                ENUM log_type "mqtt, system, error, info, warning"
                VARCHAR(255) topic
                TEXT message "NOT NULL"
                JSON payload
                TIMESTAMP created_at
                }
            </div>

            <h2>üìä Chi Ti·∫øt C√°c B·∫£ng</h2>

            <div class="section">
                <h3>1. <span class="badge badge-success">users</span> - Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</h3>
                <p>B·∫£ng n√†y l∆∞u tr·ªØ th√¥ng tin ng∆∞·ªùi d√πng v√† qu·∫£n tr·ªã vi√™n c·ªßa h·ªá th·ªëng.</p>

                <table>
                    <thead>
                        <tr>
                            <th>C·ªôt</th>
                            <th>Ki·ªÉu D·ªØ Li·ªáu</th>
                            <th>M√¥ T·∫£</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>INT (PK)</td>
                            <td>ID t·ª± ƒë·ªông tƒÉng</td>
                        </tr>
                        <tr>
                            <td><code>username</code></td>
                            <td>VARCHAR(50)</td>
                            <td>T√™n ƒëƒÉng nh·∫≠p (duy nh·∫•t)</td>
                        </tr>
                        <tr>
                            <td><code>password_hash</code></td>
                            <td>VARCHAR(255)</td>
                            <td>M·∫≠t kh·∫©u ƒë√£ m√£ h√≥a (bcrypt)</td>
                        </tr>
                        <tr>
                            <td><code>full_name</code></td>
                            <td>VARCHAR(100)</td>
                            <td>H·ªç v√† t√™n ƒë·∫ßy ƒë·ªß</td>
                        </tr>
                        <tr>
                            <td><code>role</code></td>
                            <td>ENUM</td>
                            <td>Vai tr√≤: 'admin' ho·∫∑c 'user'</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Th·ªùi gian t·∫°o t√†i kho·∫£n</td>
                        </tr>
                        <tr>
                            <td><code>updated_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Th·ªùi gian c·∫≠p nh·∫≠t cu·ªëi</td>
                        </tr>
                        <tr>
                            <td><code>last_login</code></td>
                            <td>TIMESTAMP</td>
                            <td>L·∫ßn ƒëƒÉng nh·∫≠p cu·ªëi c√πng</td>
                        </tr>
                        <tr>
                            <td><code>is_active</code></td>
                            <td>BOOLEAN</td>
                            <td>Tr·∫°ng th√°i k√≠ch ho·∫°t</td>
                        </tr>
                    </tbody>
                </table>

                <p><strong>Indexes:</strong></p>
                <ul>
                    <li><code>idx_username</code> - T√¨m ki·∫øm nhanh theo username</li>
                    <li><code>idx_role</code> - L·ªçc theo vai tr√≤</li>
                </ul>
            </div>

            <hr>

            <div class="section">
                <h3>2. <span class="badge badge-info">activity_history</span> - L·ªãch S·ª≠ Ho·∫°t ƒê·ªông</h3>
                <p>B·∫£ng n√†y ghi l·∫°i t·∫•t c·∫£ c√°c ho·∫°t ƒë·ªông c·ªßa h·ªá th·ªëng (m·ªü kh√≥a, qu√©t th·∫ª, c·∫£m bi·∫øn, v.v.).</p>

                <table>
                    <thead>
                        <tr>
                            <th>C·ªôt</th>
                            <th>Ki·ªÉu D·ªØ Li·ªáu</th>
                            <th>M√¥ T·∫£</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>INT (PK)</td>
                            <td>ID t·ª± ƒë·ªông tƒÉng</td>
                        </tr>
                        <tr>
                            <td><code>type</code></td>
                            <td>ENUM</td>
                            <td>Lo·∫°i ho·∫°t ƒë·ªông (unlock, lock, rfid, door, motion, bell, v.v.)</td>
                        </tr>
                        <tr>
                            <td><code>title</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Ti√™u ƒë·ªÅ ho·∫°t ƒë·ªông</td>
                        </tr>
                        <tr>
                            <td><code>description</code></td>
                            <td>TEXT</td>
                            <td>M√¥ t·∫£ chi ti·∫øt</td>
                        </tr>
                        <tr>
                            <td><code>icon</code></td>
                            <td>VARCHAR(500)</td>
                            <td>Icon Font Awesome</td>
                        </tr>
                        <tr>
                            <td><code>user_id</code></td>
                            <td>INT (FK)</td>
                            <td>ID ng∆∞·ªùi d√πng (n·∫øu c√≥)</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Th·ªùi gian ho·∫°t ƒë·ªông</td>
                        </tr>
                        <tr>
                            <td><code>metadata</code></td>
                            <td>JSON</td>
                            <td>D·ªØ li·ªáu b·ªï sung (JSON)</td>
                        </tr>
                        <tr>
                            <td><code>is_deleted</code></td>
                            <td>BOOLEAN</td>
                            <td>ƒê√°nh d·∫•u ƒë√£ x√≥a (soft delete)</td>
                        </tr>
                    </tbody>
                </table>

                <p><strong>Indexes:</strong></p>
                <ul>
                    <li><code>idx_type</code> - L·ªçc theo lo·∫°i ho·∫°t ƒë·ªông</li>
                    <li><code>idx_created_at</code> - S·∫Øp x·∫øp theo th·ªùi gian</li>
                    <li><code>idx_user_id</code> - L·ªçc theo ng∆∞·ªùi d√πng</li>
                    <li><code>idx_is_deleted</code> - L·ªçc b·∫£n ghi ƒë√£ x√≥a</li>
                </ul>

                <p><strong>Foreign Keys:</strong></p>
                <ul>
                    <li><code>user_id</code> ‚Üí <code>users(id)</code> ON DELETE SET NULL</li>
                </ul>
            </div>

            <hr>

            <div class="section">
                <h3>3. <span class="badge badge-warning">rfid_cards</span> - Qu·∫£n L√Ω Th·∫ª RFID</h3>
                <p>B·∫£ng n√†y qu·∫£n l√Ω c√°c th·∫ª RFID ƒë∆∞·ª£c ph√©p truy c·∫≠p h·ªá th·ªëng.</p>

                <table>
                    <thead>
                        <tr>
                            <th>C·ªôt</th>
                            <th>Ki·ªÉu D·ªØ Li·ªáu</th>
                            <th>M√¥ T·∫£</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>INT (PK)</td>
                            <td>ID t·ª± ƒë·ªông tƒÉng</td>
                        </tr>
                        <tr>
                            <td><code>uid</code></td>
                            <td>VARCHAR(50)</td>
                            <td>UID th·∫ª RFID (duy nh·∫•t)</td>
                        </tr>
                        <tr>
                            <td><code>owner_name</code></td>
                            <td>VARCHAR(100)</td>
                            <td>T√™n ch·ªß th·∫ª</td>
                        </tr>
                        <tr>
                            <td><code>description</code></td>
                            <td>TEXT</td>
                            <td>M√¥ t·∫£ th·∫ª</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>ENUM</td>
                            <td>Tr·∫°ng th√°i: 'active', 'inactive', 'blocked'</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Th·ªùi gian t·∫°o</td>
                        </tr>
                        <tr>
                            <td><code>updated_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Th·ªùi gian c·∫≠p nh·∫≠t</td>
                        </tr>
                        <tr>
                            <td><code>last_used</code></td>
                            <td>TIMESTAMP</td>
                            <td>L·∫ßn s·ª≠ d·ª•ng cu·ªëi</td>
                        </tr>
                        <tr>
                            <td><code>user_id</code></td>
                            <td>INT (FK)</td>
                            <td>ID ng∆∞·ªùi d√πng s·ªü h·ªØu</td>
                        </tr>
                    </tbody>
                </table>

                <p><strong>Indexes:</strong></p>
                <ul>
                    <li><code>idx_uid</code> - T√¨m ki·∫øm nhanh theo UID</li>
                    <li><code>idx_status</code> - L·ªçc theo tr·∫°ng th√°i</li>
                </ul>

                <p><strong>Foreign Keys:</strong></p>
                <ul>
                    <li><code>user_id</code> ‚Üí <code>users(id)</code> ON DELETE SET NULL</li>
                </ul>
            </div>

            <hr>

            <div class="section">
                <h3>4. <span class="badge badge-primary">system_logs</span> - Log H·ªá Th·ªëng</h3>
                <p>B·∫£ng n√†y ghi l·∫°i c√°c log h·ªá th·ªëng, MQTT messages v√† l·ªói.</p>

                <table>
                    <thead>
                        <tr>
                            <th>C·ªôt</th>
                            <th>Ki·ªÉu D·ªØ Li·ªáu</th>
                            <th>M√¥ T·∫£</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>INT (PK)</td>
                            <td>ID t·ª± ƒë·ªông tƒÉng</td>
                        </tr>
                        <tr>
                            <td><code>log_type</code></td>
                            <td>ENUM</td>
                            <td>Lo·∫°i log: 'mqtt', 'system', 'error', 'info', 'warning'</td>
                        </tr>
                        <tr>
                            <td><code>topic</code></td>
                            <td>VARCHAR(255)</td>
                            <td>MQTT topic (n·∫øu c√≥)</td>
                        </tr>
                        <tr>
                            <td><code>message</code></td>
                            <td>TEXT</td>
                            <td>N·ªôi dung log</td>
                        </tr>
                        <tr>
                            <td><code>payload</code></td>
                            <td>JSON</td>
                            <td>D·ªØ li·ªáu payload (JSON)</td>
                        </tr>
                        <tr>
                            <td><code>created_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>Th·ªùi gian ghi log</td>
                        </tr>
                    </tbody>
                </table>

                <p><strong>Indexes:</strong></p>
                <ul>
                    <li><code>idx_log_type</code> - L·ªçc theo lo·∫°i log</li>
                    <li><code>idx_created_at</code> - S·∫Øp x·∫øp theo th·ªùi gian</li>
                    <li><code>idx_topic</code> - T√¨m ki·∫øm theo MQTT topic</li>
                </ul>
            </div>

            <hr>

            <h2>üîó M·ªëi Quan H·ªá (Relationships)</h2>
            <div class="mermaid">
                graph LR
                A[users] -->|1:N| B[activity_history]
                A -->|1:N| C[rfid_cards]
                D[system_logs] -.-|Independent| A

                style A fill:#4CAF50,stroke:#2E7D32,color:#fff
                style B fill:#2196F3,stroke:#1565C0,color:#fff
                style C fill:#FF9800,stroke:#E65100,color:#fff
                style D fill:#9C27B0,stroke:#6A1B9A,color:#fff
            </div>

            <h3>Gi·∫£i Th√≠ch M·ªëi Quan H·ªá:</h3>
            <ol>
                <li>
                    <strong>users ‚Üí activity_history</strong> (1:N)
                    <ul>
                        <li>M·ªôt ng∆∞·ªùi d√πng c√≥ th·ªÉ t·∫°o nhi·ªÅu ho·∫°t ƒë·ªông</li>
                        <li>Foreign key: <code>activity_history.user_id</code></li>
                        <li>ON DELETE: SET NULL (gi·ªØ l·ªãch s·ª≠ khi x√≥a user)</li>
                    </ul>
                </li>
                <li>
                    <strong>users ‚Üí rfid_cards</strong> (1:N)
                    <ul>
                        <li>M·ªôt ng∆∞·ªùi d√πng c√≥ th·ªÉ s·ªü h·ªØu nhi·ªÅu th·∫ª RFID</li>
                        <li>Foreign key: <code>rfid_cards.user_id</code></li>
                        <li>ON DELETE: SET NULL (gi·ªØ th√¥ng tin th·∫ª khi x√≥a user)</li>
                    </ul>
                </li>
                <li>
                    <strong>system_logs</strong> (Independent)
                    <ul>
                        <li>B·∫£ng ƒë·ªôc l·∫≠p, kh√¥ng c√≥ foreign key</li>
                        <li>Ghi l·∫°i t·∫•t c·∫£ log h·ªá th·ªëng</li>
                    </ul>
                </li>
            </ol>

            <hr>

            <h2>üíæ D·ªØ Li·ªáu M·∫´u</h2>

            <h3>Default Admin Account</h3>
            <pre><code>username: admin
password: admin123 (hashed)
role: admin</code></pre>

            <h3>Default RFID Cards</h3>
            <table>
                <thead>
                    <tr>
                        <th>UID</th>
                        <th>Owner</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>A1B2C3D4</td>
                        <td>Admin Card</td>
                        <td>active</td>
                    </tr>
                    <tr>
                        <td>E5F6G7H8</td>
                        <td>User Card 1</td>
                        <td>active</td>
                    </tr>
                </tbody>
            </table>

            <hr>

            <h2>‚öôÔ∏è ƒê·∫∑c ƒêi·ªÉm K·ªπ Thu·∫≠t</h2>
            <ul>
                <li><strong>Engine:</strong> InnoDB (h·ªó tr·ª£ transactions v√† foreign keys)</li>
                <li><strong>Charset:</strong> UTF-8 (utf8mb4_unicode_ci)</li>
                <li><strong>Soft Delete:</strong> S·ª≠ d·ª•ng c·ªôt <code>is_deleted</code> trong
                    <code>activity_history</code></li>
                <li><strong>JSON Support:</strong> Metadata v√† payload ƒë∆∞·ª£c l∆∞u d∆∞·ªõi d·∫°ng JSON</li>
                <li><strong>Indexing:</strong> T·ªëi ∆∞u h√≥a truy v·∫•n v·ªõi indexes tr√™n c√°c c·ªôt th∆∞·ªùng xuy√™n t√¨m ki·∫øm</li>
            </ul>

            <hr>

            <h2>üèóÔ∏è S∆° ƒê·ªì Ki·∫øn Tr√∫c D·ªØ Li·ªáu</h2>
            <div class="mermaid">
                graph TB
                subgraph "Authentication Layer"
                U[users]
                end

                subgraph "Activity Tracking Layer"
                AH[activity_history]
                SL[system_logs]
                end

                subgraph "Access Control Layer"
                RC[rfid_cards]
                end

                U -.->|authenticates| AH
                U -.->|manages| RC
                RC -.->|triggers| AH
                AH -.->|logs to| SL

                style U fill:#4CAF50,stroke:#2E7D32,color:#fff
                style AH fill:#2196F3,stroke:#1565C0,color:#fff
                style RC fill:#FF9800,stroke:#E65100,color:#fff
                style SL fill:#9C27B0,stroke:#6A1B9A,color:#fff
            </div>

            <hr>

            <div class="summary">
                <h2>üìù T√≥m T·∫Øt</h2>
                <p>Database ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi 4 b·∫£ng ch√≠nh:</p>
                <ul>
                    <li>‚úÖ <strong>users</strong>: Qu·∫£n l√Ω ng∆∞·ªùi d√πng v√† ph√¢n quy·ªÅn</li>
                    <li>‚úÖ <strong>activity_history</strong>: Ghi l·∫°i m·ªçi ho·∫°t ƒë·ªông c·ªßa h·ªá th·ªëng</li>
                    <li>‚úÖ <strong>rfid_cards</strong>: Qu·∫£n l√Ω th·∫ª RFID v√† quy·ªÅn truy c·∫≠p</li>
                    <li>‚úÖ <strong>system_logs</strong>: L∆∞u tr·ªØ log h·ªá th·ªëng v√† MQTT messages</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Thi·∫øt k·∫ø n√†y ƒë·∫£m b·∫£o:</strong></p>
                <ul>
                    <li>üîí B·∫£o m·∫≠t v·ªõi m√£ h√≥a m·∫≠t kh·∫©u</li>
                    <li>üìä Theo d√µi ho·∫°t ƒë·ªông chi ti·∫øt</li>
                    <li>üé´ Qu·∫£n l√Ω quy·ªÅn truy c·∫≠p linh ho·∫°t</li>
                    <li>üìù Ghi log ƒë·∫ßy ƒë·ªß cho debugging</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#764ba2',
                lineColor: '#764ba2',
                secondaryColor: '#4CAF50',
                tertiaryColor: '#FF9800'
            }
        });
    </script>
</body>

</html>